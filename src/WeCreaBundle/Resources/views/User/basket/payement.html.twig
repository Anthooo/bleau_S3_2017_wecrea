{% extends '@WeCrea/layout/base_client.html.twig' %}

{% block body %}
<main>
    <div class="container">
        <h2>PAIMENT</h2>
        <div class="row row_top">
            <div class="col m8 s12">
                <p>Récapitulatif de la commande :</p>
                <ul>
                    {% for prod in commands.works %}
                    <li>
                        <p>
                            <span>{{ prod.title }} par {{ prod.artist }}</span><br>
                        {{ prod.caract }} x {{ prod.quant }} prix : {{ prod.price*prod.quant }}
                        </p>
                    </li>
                    {% endfor %}
                </ul>
                <p>Total hors taxes : {{ total }} €</p>
                <p>Montant de la TVA ({{ Tva }}%) : {{ tva }} €</p>
                <p>Total ttc : {{ ttc }} €</p>
            </div>
            <div class="col m4 s12 row">
                <div class="col s12">
                    <span>Addresse de facturation</span><br>
                    {{ commands.name }}<br>
                    {{ commands.addressfact }}
                    {{ commands.zipCodefact }}
                    {{ commands.townfact }}
                </div>
                <div class="col s12">
                    <span>Addresse de livraison</span><br>
                    {{ commands.name }}<br>
                    {{ commands.addressdel }}
                    {{ commands.zipCodedel }}
                    {{ commands.towndel }}
                </div>
            </div>
            <button class="pay" id="{{ commands.id }}">PAYER</button>
        </div>
        {% include '@WeCrea/User/basket/formPayzen.html.twig' %}
    </div>
</main>
{% endblock %}

{% block javascripts %}
    <script>
        $(document).ready( function () {
            $('.pay').on('click', function (e) {
                e.preventDefault();
                var data = {'id': $(this).attr('id')};
                $.ajax({
                    method: 'post',
                    url: '{{ path('we_crea_check_quant') }}',
                    data: data,

                    success: function (response) {
                        console.log(response);
                        if(response == 'ok') {
                            $('form[name="formPay"]').submit();
                        }else{
                            alert(response);
                        }
                    }
                })
            })
        })

    </script>
{% endblock %}