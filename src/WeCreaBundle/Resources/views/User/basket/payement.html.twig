{% extends '@WeCrea/layout/base_client.html.twig' %}

{% block body %}
<main>

    <div class="container">
        <h2>PAIMENT</h2>
        <div class="row row_top">
            <div class="col l5 m12 row">
                <div class="col m12">
                    <span class="title_list_profil">Addresse de facturation</span><br>
                    {{ commands.name }}<br>
                    {{ commands.addressfact }}<br>
                    {{ commands.zipCodefact }}
                    {{ commands.townfact }}
                </div>
                <div style="margin-top: 40px" class="col s12">
                    <span class="title_list_profil">Addresse de livraison</span><br>
                    {{ commands.name }}<br>
                    {{ commands.addressdel }}<br>
                    {{ commands.zipCodedel }}
                    {{ commands.towndel }}
                </div>
            </div>
            <div class="col l6 offset-l1 m12">
                <p class="title_list_profil" style="margin-top: 0">Récapitulatif de la commande :</p>
                <div class="prods row">
                    {% for prod in commands.works %}
                        <div class="prod col s12 row">
                            <div class="col s12 row">
                                <div class="prod_title col s6">
                                    <p style="margin-top: 0; margin-bottom: 10px">{{ prod.title }}</p>
                                </div>
                                <div class="prod_quant col s6">
                                    <p class="right-align" style="margin-top: 10px">
                                        Quantité : {{ prod.quant }}
                                    </p>
                                </div>
                                <div class="prod_caract col s12">
                                    <p style="margin: 0;">Informations : {{ prod.caract }}</p>
                                    <p style="margin: 0;" class=" right-align">Prix : <span class="price">{{ prod.quant * prod.price }}</span>€</p>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div class="row">
                    <div class="col m12 row">
                        <p>Total hors taxes : {{ total }} €</p>
                        <p>Montant de la TVA ({{ Tva }}%) : {{ tva }} €</p>
                        <p style="margin-top: 9px;" class="col s8"><b>Total ttc : {{ ttc }} €</b></p>
                        <div  class="col s4 center-align">
                            <button class="pay btn black" id="{{ commands.id }}">PAYER</button>
                        </div>
                    </div>

                </div>
            </div>

        </div>
        {% include '@WeCrea/User/basket/formPayzen.html.twig' %}
    </div>
</main>
{% endblock %}

{% block javascripts %}
    <script>
        $(document).ready( function () {
            $('.pay').on('click', function (e) {
                e.preventDefault();
                var data = {'id': $(this).attr('id')};
                $.ajax({
                    method: 'post',
                    url: '{{ path('we_crea_check_quant') }}',
                    data: data,

                    success: function (response) {
                        console.log(response);
                        if(response == 'ok') {
                            $('form[name="formPay"]').submit();
                        }else{
                            alert(response);
                        }
                    }
                })
            })
        })

    </script>
{% endblock %}